const searchInput=document.querySelector(".js-search"),searchButton=document.querySelector(".js-btn"),deleteButton=document.querySelector(".js-delete-btn"),pageWrapper=document.querySelector(".page-wrapper"),resultsContainer=document.querySelector(".js-results-container"),showsContainer=document.querySelector(".js-shows-container"),tipsContainer=document.querySelector(".js-tips-container"),favsContainer=document.querySelector(".js-favs-container"),noFavsContainer=document.querySelector(".js-no-favs-container");let searchedShows=[],favoritedShows=[],favoritedShowsId=[];const handleSearch=()=>{""===searchInput.value?handleEmptySearch():getDataFromApi()},getDataFromApi=async()=>{const e=searchInput.value;try{const t=await fetch("//api.tvmaze.com/search/shows?q= + "+e);if(!t.ok)throw"Im sorry, there has been a server error. Try again later!";const a=await t.json();0===Object.entries(a).length?handleNotFound():(searchedShows=a,resultsContainer.classList.add("hide"),tipsContainer.classList.remove("hide"),createParagraph("Select a TV show to add it as favorite:)",tipsContainer),createParagraph("First you need to write the name of a TV show :)",resultsContainer),createParagraph("",resultsContainer),paintShows(),listenShows(),listenFavs())}catch(e){handleServerError(e)}},createParagraph=(e,t)=>{const a=`<p class="error-message">${e}</p>`;return t.innerHTML=a},handleBackgroundImage=()=>{showsContainer.innerHTML="",pageWrapper.classList.remove("page-wrapper"),pageWrapper.classList.remove("hidden-bg"),pageWrapper.classList.add("not-found")},handleEmptySearch=()=>{resultsContainer.classList.remove("hide"),createParagraph("First you need to write the name of a TV show :)",resultsContainer),handleBackgroundImage()},handleNotFound=()=>{resultsContainer.classList.remove("hide"),createParagraph("Oops, that show is not on our database. Try again!",resultsContainer),handleBackgroundImage()},handleServerError=e=>{resultsContainer.classList.remove("hide"),createParagraph("Im sorry, there has been a server error. Try again later!",resultsContainer),handleBackgroundImage()},handleEnterKeySearch=e=>{"Enter"===e.key&&(e.preventDefault(),handleSearch())};searchButton.addEventListener("click",handleSearch),searchInput.addEventListener("keypress",handleEnterKeySearch);const paintShows=()=>{showsContainer.innerHTML="";for(let e=0;e<searchedShows.length;e++){const t=searchedShows[e].show.name,a=searchedShows[e].show.id,s=searchedShows[e].show.image,r=document.createElement("li"),o=document.createElement("img"),n=document.createElement("h3"),i=document.createTextNode(t);r.classList.add("shows-list__item","js-show-item"),r.setAttribute("data-id",a),r.appendChild(o),r.appendChild(n),o.classList.add("shows-list__img"),null!=s?(o.src=searchedShows[e].show.image.medium,o.setAttribute("alt",t+" TV show image")):(o.src="./assets/images/nopicture.png",o.setAttribute("alt","This TV show has no image")),n.classList.add("shows-list__title"),n.appendChild(i),pageWrapper.classList.add("hidden-bg"),showsContainer.appendChild(r)}},selectFavorites=e=>{const t=e.currentTarget,a=parseInt(t.dataset.id);let s={id:a,name:t.querySelector(".shows-list__title").innerHTML,image:t.querySelector(".shows-list__img").src};favoritedShowsId=favoritedShows.map((function(e){return parseInt(e.id)}));const r=favoritedShowsId.indexOf(a);-1===r?favoritedShows.push(s):favoritedShows.splice(r,1),t.classList.contains("shows-list__item--favorite")?t.classList.remove("shows-list__item--favorite"):t.classList.add("shows-list__item--favorite"),noFavsContainer.innerHTML="",paintFavorites(),listenFavs(),setLocalStorage()},listenShows=()=>{const e=document.querySelectorAll(".js-show-item");for(const t of e)t.addEventListener("click",selectFavorites)},handleNoFavs=()=>{0===favoritedShows.length&&(noFavsContainer.innerHTML='<p class="no-favs">You still don\'t have anything marked as favorites.</p>')},paintFavorites=()=>{favsContainer.innerHTML="";for(let e=0;e<favoritedShows.length;e++){const{name:t,id:a,image:s}=favoritedShows[e],r=document.createElement("li"),o=document.createElement("img"),n=document.createElement("h4"),i=document.createElement("input"),l=document.createTextNode(t);favsContainer.appendChild(r),r.classList.add("favorites-list__item"),r.appendChild(o),r.appendChild(n),r.appendChild(i),o.classList.add("favorites-list__img"),null!==s?(o.src=s,o.setAttribute("alt",t+" TV show image")):(o.src="./assets/images/nopicture.png",o.setAttribute("alt","This TV show has no image")),n.classList.add("favorites-list__title"),n.appendChild(l),i.value="x",i.classList.add("favorites-list__remove-btn"),i.setAttribute("data-id",a),i.setAttribute("type","button")}handleNoFavs(),setLocalStorage()},setLocalStorage=()=>{localStorage.setItem("favoritedShows",JSON.stringify(favoritedShows))};function getLocalStorage(){const e=localStorage.getItem("favoritedShows"),t=JSON.parse(e);null!==t&&(favoritedShows=t,paintFavorites(),listenShows())}getLocalStorage();const removeFav=e=>{for(let t=0;t<favoritedShows.length;t++){const a=e.currentTarget;parseInt(a.dataset.id)===parseInt(favoritedShows[t].id)&&favoritedShows.splice([t],1)}paintFavorites(),paintShows(),listenFavs(),listenShows(),handleNoFavs()},listenFavs=()=>{const e=document.querySelectorAll(".favorites-list__remove-btn");for(const t of e)t.addEventListener("click",removeFav)},resetFavorites=()=>{favoritedShows=[],localStorage.removeItem("favoritedShows"),handleNoFavs(),paintFavorites(),paintShows(),listenFavs(),listenShows()};deleteButton.addEventListener("click",resetFavorites);